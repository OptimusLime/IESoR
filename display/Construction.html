<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>cppn construction</title>

    <!-- include jQuery + plugins, and handling of touch on ios/android -->
    <script type="text/javascript" language="javascript" src="../libraries/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" language="javascript" src="../libraries/d3.v2.min.js"></script>
    <script type="text/javascript" language="javascript" src="../libraries/jkl-parsexml.js"></script>
    <script type="text/javascript" language="javascript" src="../libraries/loadXML.js"></script>

    <script type="text/javascript" language="javascript" src="../node_modules/cppn/cppnjs.js"></script>
    <script type="text/javascript" language="javascript" src="../node_modules/neatjs/neatjs.js"></script>
    <script type="text/javascript" language="javascript" src="../evolution/interpret/cppnToBody.js"></script>
    <script type="text/javascript" language="javascript" src="../evolution/interpret/genomeCSharpToJS.js"></script>


    <script type="text/javascript" language="javascript">



        $(window).ready(function(){


            var globals = window;
            var commonEvolution = globals['common'];

            var libLocations =
            {
                'cppnjs' : '../node_modules/cppn',
                'neatjs' : '../node_modules/neatjs'
            };

            commonEvolution.asyncLoadLibraries(libLocations, function(err)
            {
                //cppns are a go!
                var cppnjs = globals['cppnjs'];

                //let's load in the file identifying our interesting genomes

                var genomeSharpToJS = globals['genomeSharpToJS'];
                var cppnToBody = globals['cppnToBody'];

                //if you require some dependencies, you should load in library file way (i.e. load iesor.js, and that handles it)
                //for now, a quick hack
                genomeSharpToJS.CheckDependencies();
                cppnToBody.CheckDependencies();

                $.getJSON('../data/genomes/allSelectedGenomeXML.json', function(genomeDict)
                {

                    //grab grid information, for populating the D3 object
                    var gridPoints = cppnToBody.ConstructGridObject(9).grid;

                    //console.log(genomeDict);

                    var width = 350;
                    var height = 350;
                    var radius = 5;
                    var padding = 5;

                    var svg = d3.select("#d3Grid").append("svg")
                            .attr("width", width)
                            .attr("height", height)
                            .style("margin", 20);

                    var xMin = d3.min(gridPoints, function(d){return d.x;})
                    var xMax = d3.max(gridPoints, function(d){return d.x;})

                    var xScale = d3.scale.linear()
                            .domain([xMin, xMax])
                            .range([padding, width-padding]);

                    var yMin = d3.min(gridPoints, function(d){return d.y;})
                    var yMax = d3.max(gridPoints, function(d){return d.y;})

                    var yScale = d3.scale.linear()
                            .domain([yMin, yMax])
                            .range([padding, height-padding]);

                    var circles = svg.selectAll("circles")
                            .data(gridPoints)
                            .enter()
                            .append("circle")
                            .style("fill", "steelblue")
                            .attr("cx", function(d){return xScale(d.x);})
                            .attr("cy", function(d){return yScale(d.y);})
                            .attr("r", radius);


                    var processing = svg.selectAll("processCircles")
                            .data([gridPoints[0]])
                            .enter()
                            .append("circle")
                            .style("fill", "red")
                            .attr("cx", function(d){return xScale(d.x);})
                            .attr("cy", function(d){return yScale(d.y);})
                            .attr("r", radius);



                    //getjson returns a parsed json object already --- no parsing necessary

                    for(var gid in genomeDict)
                    {
                        //grab a neat genome using the loaded json object
                        var ng = genomeSharpToJS.ConvertCSharpToJS(genomeDict[gid]);
                        //we have a neat genome
                        //we should convert the genome into a cppn, then a body
                        var cppn = ng.networkDecode();

                        //used leo, and had a weight range of 3.0 for the experiments -- should yield identical creatures
                        var creature = cppnToBody.CPPNToBody(cppn, true, 3.0, true);

                        //we have a creature, verify output by sticking it into an actual environment!
                        console.log('Cppn: ');
                        console.log(cppn);
                        console.log('Creature: ');
                        console.log(creature);


                    }

                });



            });
        });

    </script>

</head>
<body>

<div id="d3Grid"></div>

</body>
</html>